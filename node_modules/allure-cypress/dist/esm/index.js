var p=function(e){return e.FAILED="failed",e.BROKEN="broken",e.PASSED="passed",e.SKIPPED="skipped",e}({}),j=[p.FAILED,p.BROKEN,p.PASSED,p.SKIPPED],h=function(e){return e.SCHEDULED="scheduled",e.RUNNING="running",e.FINISHED="finished",e.PENDING="pending",e.INTERRUPTED="interrupted",e}({}),l=function(e){return e.ALLURE_ID="ALLURE_ID",e.AS_ID="ALLURE_ID",e.SUITE="suite",e.PARENT_SUITE="parentSuite",e.SUB_SUITE="subSuite",e.EPIC="epic",e.FEATURE="feature",e.STORY="story",e.SEVERITY="severity",e.TAG="tag",e.OWNER="owner",e.LEAD="lead",e.HOST="host",e.THREAD="thread",e.TEST_METHOD="testMethod",e.TEST_CLASS="testClass",e.PACKAGE="package",e.FRAMEWORK="framework",e.LANGUAGE="language",e.LAYER="layer",e}({}),L=function(e){return e.BLOCKER="blocker",e.CRITICAL="critical",e.NORMAL="normal",e.MINOR="minor",e.TRIVIAL="trivial",e}({}),A=function(e){return e.TEXT="text/plain",e.XML="application/xml",e.HTML="text/html",e.CSV="text/csv",e.TSV="text/tab-separated-values",e.CSS="text/css",e.URI="text/uri-list",e.SVG="image/svg+xml",e.PNG="image/png",e.JSON="application/json",e.ZIP="application/zip",e.WEBM="video/webm",e.JPEG="image/jpeg",e.MP4="video/mp4",e.IMAGEDIFF="application/vnd.allure.image.diff",e}({}),E=function(e){return e.ISSUE="issue",e.TMS="tms",e}({});function O(e,t,r,s,n,a,i){try{var u=e[a](i),o=u.value}catch(g){return void r(g)}u.done?t(o):Promise.resolve(o).then(s,n)}function d(e){return function(){var t=this,r=arguments;return new Promise(function(s,n){var a=e.apply(t,r);function i(o){O(a,s,n,i,u,"next",o)}function u(o){O(a,s,n,i,u,"throw",o)}i(void 0)})}}var R=class{attachment(){var t=this;return d(function*(){yield t.warning()})()}attachmentFromPath(){var t=this;return d(function*(){yield t.warning()})()}description(){var t=this;return d(function*(){yield t.warning()})()}descriptionHtml(){var t=this;return d(function*(){yield t.warning()})()}displayName(){var t=this;return d(function*(){yield t.warning()})()}historyId(){var t=this;return d(function*(){yield t.warning()})()}labels(){var t=this;return d(function*(){yield t.warning()})()}links(){var t=this;return d(function*(){yield t.warning()})()}parameter(){var t=this;return d(function*(){yield t.warning()})()}step(t,r){var s=this;return d(function*(){return yield s.warning(),r()})()}stepDisplayName(){var t=this;return d(function*(){yield t.warning()})()}stepParameter(){var t=this;return d(function*(){yield t.warning()})()}testCaseId(){var t=this;return d(function*(){yield t.warning()})()}warning(){return d(function*(){console.log("no test runtime is found. Please check test framework configuration")})()}},y=new R;var C="allureTestRuntime",T=e=>{globalThis[C]=()=>e},b=()=>globalThis?.[C],v=()=>{var e=b();if(e){var t;return(t=e())!==null&&t!==void 0?t:y}return y},w=()=>{var e=b();if(e){var t;return(t=e())!==null&&t!==void 0?t:y}if("_playwrightInstance"in globalThis)try{return(0,eval)("(() => import('allure-playwright/autoconfig'))()").then(()=>{var r,s;return(r=(s=b())===null||s===void 0?void 0:s())!==null&&r!==void 0?r:y})}catch(r){return console.log("can't execute allure-playwright/autoconfig",r),y}return y};function x(){x=function(a,i){return new r(a,void 0,i)};var e=RegExp.prototype,t=new WeakMap;function r(n,a,i){var u=RegExp(n,a);return t.set(u,i||t.get(n)),S(u,r.prototype)}function s(n,a){var i=t.get(a);return Object.keys(i).reduce(function(u,o){var g=i[o];if(typeof g=="number")u[o]=n[g];else{for(var f=0;n[g[f]]===void 0&&f+1<g.length;)f++;u[o]=n[g[f]]}return u},Object.create(null))}return U(r,RegExp),r.prototype.exec=function(n){var a=e.exec.call(this,n);if(a){a.groups=s(a,this);var i=a.indices;i&&(i.groups=s(i,this))}return a},r.prototype[Symbol.replace]=function(n,a){if(typeof a=="string"){var i=t.get(this);return e[Symbol.replace].call(this,n,a.replace(/\$<([^>]+)>/g,function(o,g){var f=i[g];return"$"+(Array.isArray(f)?f.join("$"):f)}))}if(typeof a=="function"){var u=this;return e[Symbol.replace].call(this,n,function(){var o=arguments;return typeof o[o.length-1]!="object"&&(o=[].slice.call(o)).push(s(o,u)),a.apply(this,o)})}return e[Symbol.replace].call(this,n,a)},x.apply(this,arguments)}function U(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}function S(e,t){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},S(e,t)}var H=x(/@?allure.id[:=]([^\s]+)/,{id:1}),be=new RegExp(H,"g"),B=x(/@?allure.label.([^\s]+?)[:=]([^\s]+)/,{name:1,value:2}),Te=new RegExp(B,"g");var I=e=>e.some(t=>t.type==="step_start"||t.type==="step_stop"),k=e=>e.reduce((t,r)=>{if(r.type!=="step_start"&&r.type!=="step_stop")return t;if(r.type==="step_start")return t.push([r]),t;var s=t.findLastIndex(n=>n.length===1);return s===-1||t[s].push(r),t},[]),M=e=>{var t=k(e);return t.filter(r=>r.length===1)},P=e=>!!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function";var c=function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),n=1;n<r;n++)s[n-1]=arguments[n];var a=w();return P(a)?a.then(i=>i[t](...s)):a[t](...s)},m=(e,t)=>c("labels",{name:e,value:t}),K=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return c("labels",...r)},_=(e,t,r)=>c("links",{url:e,type:r,name:t}),z=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return c("links",...r)},V=(e,t,r)=>c("parameter",e,t,r),W=e=>c("description",e),Y=e=>c("descriptionHtml",e),Z=e=>c("displayName",e),$=e=>c("historyId",e),J=e=>c("testCaseId",e),X=(e,t,r)=>{var s=typeof r=="string"?{contentType:r}:r;return c("attachment",e,t,s)};var q=()=>({displayName:e=>c("stepDisplayName",e),parameter:(e,t,r)=>c("stepParameter",e,t,r)}),Q=(e,t)=>c("step",e,()=>t(q())),ee=(e,t)=>_(e,t,E.ISSUE),te=(e,t)=>_(e,t,E.TMS),re=e=>m(l.ALLURE_ID,e),se=e=>m(l.EPIC,e),ne=e=>m(l.FEATURE,e),ae=e=>m(l.STORY,e),ie=e=>m(l.SUITE,e),oe=e=>m(l.PARENT_SUITE,e),ue=e=>m(l.SUB_SUITE,e),pe=e=>m(l.OWNER,e),le=e=>m(l.SEVERITY,e),ce=e=>m(l.LAYER,e),de=e=>m(l.TAG,e),me=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return c("labels",...r.map(n=>({name:l.TAG,value:n})))};var F=e=>Array.isArray(e)||e.buffer?btoa(String.fromCharCode.apply(null,e)):e,G=(e,t)=>Array.isArray(e)||e.buffer?"base64":t,N=e=>{let t=[],r=e.parent;for(;r;)r.title&&t.unshift(r.title),r=r.parent;return t};var D=class{labels(...t){return this.sendMessageAsync({type:"metadata",data:{labels:t}})}links(...t){return this.sendMessageAsync({type:"metadata",data:{links:t}})}parameter(t,r,s){return this.sendMessageAsync({type:"metadata",data:{parameters:[{name:t,value:r,...s}]}})}description(t){return this.sendMessageAsync({type:"metadata",data:{description:t}})}descriptionHtml(t){return this.sendMessageAsync({type:"metadata",data:{descriptionHtml:t}})}displayName(t){return this.sendMessageAsync({type:"metadata",data:{displayName:t}})}historyId(t){return this.sendMessageAsync({type:"metadata",data:{historyId:t}})}testCaseId(t){return this.sendMessageAsync({type:"metadata",data:{testCaseId:t}})}attachment(t,r,s){let n=r?.type==="Buffer"?r.data:r,a=r instanceof Buffer?"base64":"utf-8",i=G(n,a),u=F(n);return this.sendMessageAsync({type:"attachment_content",data:{name:t,content:u,encoding:i,contentType:s.contentType,fileExtension:s.fileExtension}})}attachmentFromPath(t,r,s){return this.sendMessageAsync({type:"attachment_path",data:{name:t,path:r,contentType:s.contentType,fileExtension:s.fileExtension}})}step(t,r){return cy.wrap(null,{log:!1}).then(()=>(this.sendMessage({type:"step_start",data:{name:t,start:Date.now()}}),Cypress.Promise.resolve(r()))).then(s=>this.sendMessageAsync({type:"step_stop",data:{status:p.PASSED,stage:h.FINISHED,stop:Date.now()}}).then(()=>s))}stepDisplayName(t){return this.sendMessageAsync({type:"step_metadata",data:{name:t}})}stepParameter(t,r,s){return this.sendMessageAsync({type:"step_metadata",data:{parameters:[{name:t,value:r,mode:s}]}})}sendMessage(t){let r=Cypress.env("allureRuntimeMessages")||[];Cypress.env("allureRuntimeMessages",r.concat(t))}sendMessageAsync(t){return this.sendMessage(t),Cypress.Promise.resolve()}},{EVENT_TEST_BEGIN:he,EVENT_TEST_FAIL:ye,EVENT_TEST_PASS:ve}=Mocha.Runner.constants,Ee=()=>{Cypress.env("allureInitialized")||(Cypress.mocha.getRunner().on(he,t=>{let r=new D;Cypress.env("allureRuntimeMessages",[]),r.sendMessage({type:"cypress_start",data:{isInteractive:Cypress.config("isInteractive"),absolutePath:Cypress.spec.absolute,specPath:N(t).concat(t.title),filename:Cypress.spec.relative,start:Date.now()}}),T(r)}).on(ve,()=>{let t=v(),r=Cypress.env("allureRuntimeMessages");M(r).forEach(()=>{t.sendMessage({type:"step_stop",data:{stage:h.FINISHED,status:p.PASSED,stop:Date.now()}})}),t.sendMessage({type:"cypress_end",data:{stage:h.FINISHED,status:p.PASSED,stop:Date.now()}})}).on(ye,(t,r)=>{v().sendMessage({type:"cypress_end",data:{stage:h.FINISHED,status:r.constructor.name==="AssertionError"?p.FAILED:p.BROKEN,statusDetails:{message:r.message,trace:r.stack},stop:Date.now()}})}),Cypress.Screenshot.defaults({onAfterScreenshot:(t,r)=>v().sendMessageAsync({type:"attachment_path",data:{path:r.path,name:r.name||"Screenshot",contentType:A.PNG}})}),Cypress.on("fail",t=>{let r=v(),s=Cypress.env("allureRuntimeMessages");if(!I(s))throw t;let a=M(s);if(a.length===0)throw t;let i=t.constructor.name==="AssertionError"?p.FAILED:p.BROKEN;throw a.forEach(()=>{r.sendMessage({type:"step_stop",data:{stage:h.FINISHED,status:i,stop:Date.now(),statusDetails:{message:t.message,trace:t.stack}}})}),t}),afterEach(()=>{let t=Cypress.env("allureRuntimeMessages");cy.task("allureReportTest",t,{log:!1})}),Cypress.env("allureInitialized",!0))};Ee();export{D as AllureCypressTestRuntime,A as ContentType,l as LabelName,E as LinkType,L as Severity,h as Stage,p as Status,j as StatusByPriority,re as allureId,X as attachment,W as description,Y as descriptionHtml,Z as displayName,se as epic,ne as feature,$ as historyId,ee as issue,m as label,K as labels,ce as layer,_ as link,z as links,pe as owner,V as parameter,oe as parentSuite,le as severity,Q as step,ae as story,ue as subSuite,ie as suite,de as tag,me as tags,J as testCaseId,te as tms};
//# sourceMappingURL=index.js.map
