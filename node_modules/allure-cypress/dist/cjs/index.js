"use strict";var T=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var de=Object.prototype.hasOwnProperty;var me=(e,t)=>{for(var r in t)T(e,r,{get:t[r],enumerable:!0})},ge=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ce(t))!de.call(e,n)&&n!==r&&T(e,n,{get:()=>t[n],enumerable:!(s=le(t,n))||s.enumerable});return e};var fe=e=>ge(T({},"__esModule",{value:!0}),e);var we={};me(we,{AllureCypressTestRuntime:()=>b,ContentType:()=>x,LabelName:()=>l,LinkType:()=>E,Severity:()=>F,Stage:()=>f,Status:()=>p,StatusByPriority:()=>C,allureId:()=>$,attachment:()=>V,description:()=>H,descriptionHtml:()=>B,displayName:()=>k,epic:()=>J,feature:()=>X,historyId:()=>K,issue:()=>Y,label:()=>m,labels:()=>j,layer:()=>ne,link:()=>R,links:()=>L,owner:()=>re,parameter:()=>U,parentSuite:()=>ee,severity:()=>se,step:()=>W,story:()=>q,subSuite:()=>te,suite:()=>Q,tag:()=>ae,tags:()=>ie,testCaseId:()=>z,tms:()=>Z});module.exports=fe(we);var p=function(e){return e.FAILED="failed",e.BROKEN="broken",e.PASSED="passed",e.SKIPPED="skipped",e}({}),C=[p.FAILED,p.BROKEN,p.PASSED,p.SKIPPED],f=function(e){return e.SCHEDULED="scheduled",e.RUNNING="running",e.FINISHED="finished",e.PENDING="pending",e.INTERRUPTED="interrupted",e}({}),l=function(e){return e.ALLURE_ID="ALLURE_ID",e.AS_ID="ALLURE_ID",e.SUITE="suite",e.PARENT_SUITE="parentSuite",e.SUB_SUITE="subSuite",e.EPIC="epic",e.FEATURE="feature",e.STORY="story",e.SEVERITY="severity",e.TAG="tag",e.OWNER="owner",e.LEAD="lead",e.HOST="host",e.THREAD="thread",e.TEST_METHOD="testMethod",e.TEST_CLASS="testClass",e.PACKAGE="package",e.FRAMEWORK="framework",e.LANGUAGE="language",e.LAYER="layer",e}({}),F=function(e){return e.BLOCKER="blocker",e.CRITICAL="critical",e.NORMAL="normal",e.MINOR="minor",e.TRIVIAL="trivial",e}({}),x=function(e){return e.TEXT="text/plain",e.XML="application/xml",e.HTML="text/html",e.CSV="text/csv",e.TSV="text/tab-separated-values",e.CSS="text/css",e.URI="text/uri-list",e.SVG="image/svg+xml",e.PNG="image/png",e.JSON="application/json",e.ZIP="application/zip",e.WEBM="video/webm",e.JPEG="image/jpeg",e.MP4="video/mp4",e.IMAGEDIFF="application/vnd.allure.image.diff",e}({}),E=function(e){return e.ISSUE="issue",e.TMS="tms",e}({});function G(e,t,r,s,n,a,i){try{var u=e[a](i),o=u.value}catch(g){return void r(g)}u.done?t(o):Promise.resolve(o).then(s,n)}function d(e){return function(){var t=this,r=arguments;return new Promise(function(s,n){var a=e.apply(t,r);function i(o){G(a,s,n,i,u,"next",o)}function u(o){G(a,s,n,i,u,"throw",o)}i(void 0)})}}var w=class{attachment(){var t=this;return d(function*(){yield t.warning()})()}attachmentFromPath(){var t=this;return d(function*(){yield t.warning()})()}description(){var t=this;return d(function*(){yield t.warning()})()}descriptionHtml(){var t=this;return d(function*(){yield t.warning()})()}displayName(){var t=this;return d(function*(){yield t.warning()})()}historyId(){var t=this;return d(function*(){yield t.warning()})()}labels(){var t=this;return d(function*(){yield t.warning()})()}links(){var t=this;return d(function*(){yield t.warning()})()}parameter(){var t=this;return d(function*(){yield t.warning()})()}step(t,r){var s=this;return d(function*(){return yield s.warning(),r()})()}stepDisplayName(){var t=this;return d(function*(){yield t.warning()})()}stepParameter(){var t=this;return d(function*(){yield t.warning()})()}testCaseId(){var t=this;return d(function*(){yield t.warning()})()}warning(){return d(function*(){console.log("no test runtime is found. Please check test framework configuration")})()}},y=new w;var N="allureTestRuntime",P=e=>{globalThis[N]=()=>e},I=()=>globalThis?.[N],v=()=>{var e=I();if(e){var t;return(t=e())!==null&&t!==void 0?t:y}return y},_=()=>{var e=I();if(e){var t;return(t=e())!==null&&t!==void 0?t:y}if("_playwrightInstance"in globalThis)try{return(0,eval)("(() => import('allure-playwright/autoconfig'))()").then(()=>{var r,s;return(r=(s=I())===null||s===void 0?void 0:s())!==null&&r!==void 0?r:y})}catch(r){return console.log("can't execute allure-playwright/autoconfig",r),y}return y};function S(){S=function(a,i){return new r(a,void 0,i)};var e=RegExp.prototype,t=new WeakMap;function r(n,a,i){var u=RegExp(n,a);return t.set(u,i||t.get(n)),M(u,r.prototype)}function s(n,a){var i=t.get(a);return Object.keys(i).reduce(function(u,o){var g=i[o];if(typeof g=="number")u[o]=n[g];else{for(var h=0;n[g[h]]===void 0&&h+1<g.length;)h++;u[o]=n[g[h]]}return u},Object.create(null))}return he(r,RegExp),r.prototype.exec=function(n){var a=e.exec.call(this,n);if(a){a.groups=s(a,this);var i=a.indices;i&&(i.groups=s(i,this))}return a},r.prototype[Symbol.replace]=function(n,a){if(typeof a=="string"){var i=t.get(this);return e[Symbol.replace].call(this,n,a.replace(/\$<([^>]+)>/g,function(o,g){var h=i[g];return"$"+(Array.isArray(h)?h.join("$"):h)}))}if(typeof a=="function"){var u=this;return e[Symbol.replace].call(this,n,function(){var o=arguments;return typeof o[o.length-1]!="object"&&(o=[].slice.call(o)).push(s(o,u)),a.apply(this,o)})}return e[Symbol.replace].call(this,n,a)},S.apply(this,arguments)}function he(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&M(e,t)}function M(e,t){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},M(e,t)}var ye=S(/@?allure.id[:=]([^\s]+)/,{id:1}),Fe=new RegExp(ye,"g"),ve=S(/@?allure.label.([^\s]+?)[:=]([^\s]+)/,{name:1,value:2}),Ge=new RegExp(ve,"g");var D=e=>e.some(t=>t.type==="step_start"||t.type==="step_stop"),Ee=e=>e.reduce((t,r)=>{if(r.type!=="step_start"&&r.type!=="step_stop")return t;if(r.type==="step_start")return t.push([r]),t;var s=t.findLastIndex(n=>n.length===1);return s===-1||t[s].push(r),t},[]),A=e=>{var t=Ee(e);return t.filter(r=>r.length===1)},O=e=>!!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function";var c=function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),n=1;n<r;n++)s[n-1]=arguments[n];var a=_();return O(a)?a.then(i=>i[t](...s)):a[t](...s)},m=(e,t)=>c("labels",{name:e,value:t}),j=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return c("labels",...r)},R=(e,t,r)=>c("links",{url:e,type:r,name:t}),L=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return c("links",...r)},U=(e,t,r)=>c("parameter",e,t,r),H=e=>c("description",e),B=e=>c("descriptionHtml",e),k=e=>c("displayName",e),K=e=>c("historyId",e),z=e=>c("testCaseId",e),V=(e,t,r)=>{var s=typeof r=="string"?{contentType:r}:r;return c("attachment",e,t,s)};var xe=()=>({displayName:e=>c("stepDisplayName",e),parameter:(e,t,r)=>c("stepParameter",e,t,r)}),W=(e,t)=>c("step",e,()=>t(xe())),Y=(e,t)=>R(e,t,E.ISSUE),Z=(e,t)=>R(e,t,E.TMS),$=e=>m(l.ALLURE_ID,e),J=e=>m(l.EPIC,e),X=e=>m(l.FEATURE,e),q=e=>m(l.STORY,e),Q=e=>m(l.SUITE,e),ee=e=>m(l.PARENT_SUITE,e),te=e=>m(l.SUB_SUITE,e),re=e=>m(l.OWNER,e),se=e=>m(l.SEVERITY,e),ne=e=>m(l.LAYER,e),ae=e=>m(l.TAG,e),ie=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return c("labels",...r.map(n=>({name:l.TAG,value:n})))};var oe=e=>Array.isArray(e)||e.buffer?btoa(String.fromCharCode.apply(null,e)):e,ue=(e,t)=>Array.isArray(e)||e.buffer?"base64":t,pe=e=>{let t=[],r=e.parent;for(;r;)r.title&&t.unshift(r.title),r=r.parent;return t};var b=class{labels(...t){return this.sendMessageAsync({type:"metadata",data:{labels:t}})}links(...t){return this.sendMessageAsync({type:"metadata",data:{links:t}})}parameter(t,r,s){return this.sendMessageAsync({type:"metadata",data:{parameters:[{name:t,value:r,...s}]}})}description(t){return this.sendMessageAsync({type:"metadata",data:{description:t}})}descriptionHtml(t){return this.sendMessageAsync({type:"metadata",data:{descriptionHtml:t}})}displayName(t){return this.sendMessageAsync({type:"metadata",data:{displayName:t}})}historyId(t){return this.sendMessageAsync({type:"metadata",data:{historyId:t}})}testCaseId(t){return this.sendMessageAsync({type:"metadata",data:{testCaseId:t}})}attachment(t,r,s){let n=r?.type==="Buffer"?r.data:r,a=r instanceof Buffer?"base64":"utf-8",i=ue(n,a),u=oe(n);return this.sendMessageAsync({type:"attachment_content",data:{name:t,content:u,encoding:i,contentType:s.contentType,fileExtension:s.fileExtension}})}attachmentFromPath(t,r,s){return this.sendMessageAsync({type:"attachment_path",data:{name:t,path:r,contentType:s.contentType,fileExtension:s.fileExtension}})}step(t,r){return cy.wrap(null,{log:!1}).then(()=>(this.sendMessage({type:"step_start",data:{name:t,start:Date.now()}}),Cypress.Promise.resolve(r()))).then(s=>this.sendMessageAsync({type:"step_stop",data:{status:p.PASSED,stage:f.FINISHED,stop:Date.now()}}).then(()=>s))}stepDisplayName(t){return this.sendMessageAsync({type:"step_metadata",data:{name:t}})}stepParameter(t,r,s){return this.sendMessageAsync({type:"step_metadata",data:{parameters:[{name:t,value:r,mode:s}]}})}sendMessage(t){let r=Cypress.env("allureRuntimeMessages")||[];Cypress.env("allureRuntimeMessages",r.concat(t))}sendMessageAsync(t){return this.sendMessage(t),Cypress.Promise.resolve()}},{EVENT_TEST_BEGIN:Ae,EVENT_TEST_FAIL:Re,EVENT_TEST_PASS:be}=Mocha.Runner.constants,Te=()=>{Cypress.env("allureInitialized")||(Cypress.mocha.getRunner().on(Ae,t=>{let r=new b;Cypress.env("allureRuntimeMessages",[]),r.sendMessage({type:"cypress_start",data:{isInteractive:Cypress.config("isInteractive"),absolutePath:Cypress.spec.absolute,specPath:pe(t).concat(t.title),filename:Cypress.spec.relative,start:Date.now()}}),P(r)}).on(be,()=>{let t=v(),r=Cypress.env("allureRuntimeMessages");A(r).forEach(()=>{t.sendMessage({type:"step_stop",data:{stage:f.FINISHED,status:p.PASSED,stop:Date.now()}})}),t.sendMessage({type:"cypress_end",data:{stage:f.FINISHED,status:p.PASSED,stop:Date.now()}})}).on(Re,(t,r)=>{v().sendMessage({type:"cypress_end",data:{stage:f.FINISHED,status:r.constructor.name==="AssertionError"?p.FAILED:p.BROKEN,statusDetails:{message:r.message,trace:r.stack},stop:Date.now()}})}),Cypress.Screenshot.defaults({onAfterScreenshot:(t,r)=>v().sendMessageAsync({type:"attachment_path",data:{path:r.path,name:r.name||"Screenshot",contentType:x.PNG}})}),Cypress.on("fail",t=>{let r=v(),s=Cypress.env("allureRuntimeMessages");if(!D(s))throw t;let a=A(s);if(a.length===0)throw t;let i=t.constructor.name==="AssertionError"?p.FAILED:p.BROKEN;throw a.forEach(()=>{r.sendMessage({type:"step_stop",data:{stage:f.FINISHED,status:i,stop:Date.now(),statusDetails:{message:t.message,trace:t.stack}}})}),t}),afterEach(()=>{let t=Cypress.env("allureRuntimeMessages");cy.task("allureReportTest",t,{log:!1})}),Cypress.env("allureInitialized",!0))};Te();
//# sourceMappingURL=index.js.map
